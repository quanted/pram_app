/***************************************
* @preserve
* ForeSee Client Code: Trigger
* http://www.answers.com/page/businesssolutions
* Built September 15, 16 12:03:55
* Code version: 19.0.33
* Template version: 19.0.33
***************************************/
("undefined"!=typeof _acsDefine?_acsDefine:define)(["require","_acs","triggerconfig",_acsNormalizeUrl("foresee/fs.utils.js")],function(e,t,config,i){"string"==typeof t.startTS&&(t.startTS=i.now());var r={},s=function(e,t,r,s,n){var o={width:700,height:350,left:50,top:50,resizable:"no",scrollbar:"1",scrollbars:"1",toolbar:"no",menubar:"no",location:"1",directories:"no",status:"no"},a=i.ext(o,r),c="";for(var f in a)c+=f+"="+a[f]+",";var l=this._win=window.open(e,t,c);if(l&&n)if(l.blur(),l.opener.window.focus(),window.self.window.focus(),window.focus(),"Firefox"==s.browser.name){var u=window.open("about:blank");u.focus(),u.close()}else s.isIE&&setTimeout(function(){l.blur(),l.opener.window.focus(),window.self.window.focus(),window.focus()},1e3);return l},n=function(){var e=this;this.isOver=!0,i.Bind(document,"trigger:mouseout",function(t){t=t?t:window.event;var i=t.relatedTarget||t.toElement;i&&"HTML"!=i.nodeName||e.isOver&&(e.isOver=!1)},!1),i.Bind(document,"trigger:mouseover",function(t){e.isOver||(e.isOver=!0)},!1),i.Bind(document,"trigger:mousemove",function(t){e.isOver||(e.isOver=!0)})},o={INVITE_SHOWN:100,INVITE_ACCEPTED:101,INVITE_DECLINED:102,INVITE_ABANDONED:105,INVITE_PAGE_SHOWN:104,TRACKER_SHOWN:200,TRACKER_CLOSED:201,TRACKER_CLICKED:202,QUALIFIER_SHOWN:300,QUALIFIER_ACCEPTED:301,SURVEY_SHOWN:400,CANCEL_SHOWN:500,PURCHASE_EVENT:800,ITEMS_EVENT:801,DOLLARS_EVENT:802},a="survey.foreseeresults.com",c="events.foreseeresults.com",f=".4seeresults.com",l="i.4see.mobi",u={SERVICE_TYPES:{survey:{host:a,path:"/survey",url:"/display",protocol:"https"},mobileOnExitInitialize:{host:l,path:"/e",url:"/initialize"},mobileOnExitHeartbeat:{host:l,path:"/e",url:"/recordHeartbeat"},check:{host:"controller"+f,path:"/fsrSurvey",url:"/OTCImg",success:3},event:{host:c,path:"/rec",url:"/process?event=logit"},domain:{host:a,path:"/survey",url:"/FSRImg",success:3},replay:{host:"replaycontroller"+f,path:"/images",enabled:!0}}};u.log=function(e,t,config,r,s,n,o,a){var c=new Date,f=new i.ImageTransport,l=config.config,u=s.get("rid"),d=s.get("q"),h={ver:1,cid:l.id,rid:u,q:d,type:s.get("dn")||"",site:l.site_id,msg:n,tms:c.getTime(),tmz:6e4*c.getTimezoneOffset()};if(r&&(h.cat=r.name||"",h.sec=r.section||"",h.lang=r.language.locale||""),"object"==typeof t){h.param="";for(var p in t)h.param+=encodeURIComponent(p)+"="+encodeURIComponent(t[p])+"&"}else"string"==typeof t&&(h.param=t);for(var g in h)"undefined"!=typeof h[g]&&null!==h[g]||delete h[g];f.send({url:"https://"+e.host+e.path+(e.url||""),success:o||function(){},failure:a||function(){},data:h})},u.ping=function(e,t,r,s){var n=new i.ImageTransport;n.send({url:"https://"+e.host+e.path+(e.url||""),success:r||function(){},failure:s||function(){},data:t})};var d=function(r,s,n,o,a,c,f){if(this.trig=r,this.browser=s,this.stg=n,this.cpps=o,this.events=a,this.displayoverride=c,i.isDefined(this.trig.surveydef.inviteExclude)&&i.isDefined(this.trig.crit)&&this.trig.crit.runAllTests(this.trig.surveydef.inviteExclude,this.browser,!1,!0))return!1;var l=this;u.ping(u.SERVICE_TYPES.check,{protocol:"https"},function(){e([t.makeURI("foresee/fs.invite.js")],function(e){var t=l.invite=r.invite=new e(config,r.surveydef,s,n.fstg,c,o);n.set("dn",t.display.displayname),o.set("dn",t.display.displayname),f&&f.call(l)})},function(){})};d.prototype.initialize=function(){var e=this.trig,s=(this.browser,this.stg),n=this.cpps,a=this.events,c=(this.displayoverride,this.invite);c.loadResources(function(){setTimeout(function(){c.present(),a.inviteShown&&a.inviteShown(e.surveydef,s,config,n),u.log(u.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,s,o.INVITE_SHOWN)},Math.max(0,config.config.inviteDelay-(i.now()-t.startTS)))}),c.declined.subscribe(function(){s.setNewRepeatDays(config.config.repeatDays.decline),a.inviteDeclined&&a.inviteDeclined(e.surveydef,s,config,n),e.surveydef.cxRecord&&r.rec&&(r.rec.cancelRecord(),e.recordController=r.rec=null),u.log(u.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,s,o.INVITE_DECLINED),s.set("i","d")});var f=function(t,i){var r=new S(i,config,e.surveydef,n,s.get("rid"));r.init(t,function(){r.beginHeartbeat()})};c.abandoned.subscribe(function(){u.log(u.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,s,o.INVITE_ABANDONED),s.set("i","a"),s.set("rw",i.now()+config.config.reinviteDelayAfterInviteAbandon)}),c.accepted.subscribe(function(t,l){switch(s.setNewRepeatDays(config.config.repeatDays.accept),a.inviteAccepted&&a.inviteAccepted(e.surveydef,s,config,n),e.surveydef.cxRecord&&r.rec&&r.rec.recorder&&(r.rec.beginTransmitting(),n.set("replay_id",r.rec.recorder.logger.gsessionid),n.set("sessionid",r.rec.recorder.logger.sessionid)),u.log(u.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,s,o.INVITE_ACCEPTED),s.set("i","x"),s.set("ixw",i.now()),t){case"TRACKER":e.popTracker(c);break;case"INSESSION":e.popSurvey();break;case"SMS":f(l,t);break;case"EMAIL":f(l,t);break;case"SMSEMAIL":f(l,t)}})};var h=function(e){this.fstg=e,this.lasthbval=0,this.heartbeatExpired=new i.FSEvent,this.enabled=!0,this.fstg.trackerHeartbeat.subscribe(i.proxy(function(){this.enabled&&(this.lasthbval=i.now(),this._resetTimer())},this))};h.prototype._resetTimer=function(){this._timer&&(clearTimeout(this._timer),this._timer=0),this._timer=setTimeout(i.proxy(function(){this.heartbeatExpired.fire(),this.enabled=!1},this),2500)};var p=function(e,s,a,c,f,l,d,h,p){r.tracker&&(r.tracker.dispose(),r.tracker=null),r.tracker=this,this.template=e,this.def=s,this.cfg=a,this.disp=h,this.fstg=f,this.mtrk=new n,this.br=p,this.cpps=d,this._fcBindings=[],e&&this._fcBindings.push(f.trackerHeartbeat.subscribe(function(){l.trackerShown&&l.trackerShown(s,c,a,d),u.log(u.SERVICE_TYPES.event,window.location.toString(),a,s,c,o.TRACKER_SHOWN)},!0,!1));var g=i.proxy(function(){f._postMessage("trackercmd",{method:"hb",tm:i.now()})},this);this._heartbeat=setInterval(g,Math.round(a.config.trackerHeartbeatTimeout/2)),g(),i.Bind(window,"unload",i.proxy(function(){this.mtrk.isOver&&this.fstg&&this.fstg._postMessage("trackercmd",{method:"hbx",tm:i.now()})},this)),this._url=t.makeURI("foresee/fs.tracker.html?domain="+encodeURIComponent(document.domain.toString())+"&fsrlocale="+encodeURIComponent(d.get("locale")||"en")),this.fstg.isSSL&&("//"==this._url.substr(0,2)&&(this._url="https:"+this._url),this._url=this._url.replace(/http:/i,"https:")),this._sendDefinition()};p.prototype._sendDefinition=function(){var e=this,t={method:"init",cfg:this.cfg,def:this.def};this.disp&&(t.display=this.disp),this.template&&(t.template=this.template),e._fcBindings.push(e.fstg.trackerHeartbeat.subscribe(function(){e.fstg._postMessage("trackercmd",{method:"trackerinfo",data:t}),e.cpps.save()},!0,!0))},p.prototype.show=function(e){this.wref=s(this._url,"acsTracker",{width:700,height:450},e,!0)},p.prototype.applyExisting=function(e,t){this.wref=t,t.location=this._url},p.prototype.dispose=function(){for(var e=0;e<this._fcBindings.length;e++)this._fcBindings[e].unsubscribe();this.fstg=null};var g=function(config,e,t){this.cfg=config,this.cpps=e,this.def=t,this.locale=e.get("locale")||"en"};g.prototype.getUrl=function(){var e=encodeURIComponent,t=this.def,r=this.cfg.config.surveyUrl+"?",s=i.now()+"_"+Math.round(1e13*Math.random()),n=t.name+"-"+(i.isDefined(t.site)?t.site+"-":"")+(i.isDefined(t.section)?this.def.section+"-":"")+this.locale,o={sid:e(n),cid:e(this.cfg.config.id),pattern:e(this.cpps.get(t.pattern)),a:s,b:i.hash(s),c:864e5,version:this.cfg.config.version};for(var a in o)r+=encodeURIComponent(a)+"="+encodeURIComponent(o[a])+"&";return r+=this.cpps.toQueryString()};var v=function(config){this.cfg=config};v.prototype={isDomainEnabled:function(){var e,t=this.cfg.properties.analytics.google_remote;if(t){var i=options_.site.domain;t[i]&&(e=t[i])}return e},toQueryString:function(e){var t={},r=this.isDomainEnabled();return r&&(t.domain="."+options_.site.domain,t.id=r.id,t.name=r.name,e&&(t.event=e)),i.toQueryString(t,"ga")},getEvent:function(e){var t;return this.isDomainEnabled()&&gad.events&&(t=gad.events[e]),t},fireEvent:function(e){var t=this.isDomainEnabled();if(t){window._gaq=window._gaq||[];var i=this.getEvent(e);i&&window._gaq.push(["_trackEvent","foresee survey",i,t.name])}},getLinkerUrl:function(e){var t=e;if(this.isDomainEnabled()&&window._gat){var i=window._gat._getTrackerByName();t=i._getLinkerUrl(e)}return t},init:function(){if(this.isDomainEnabled()){window._gaq=window._gaq||[],window._gaq.push(["_setAccount",gad.id]),window._gaq.push(["_setDomainName","."+options_.site.domain]),window._gaq.push(["_trackPageview"]);var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}}};var w=function(e,config){this.stg=e,this.cfg=config};w.prototype.calcReplayPoolStatus=function(e){var t,r,s,n,o,a=this.cfg.config,c=a.replay_pools,f=window.location.toString();if(c&&0!==c.length&&this.pooloverride!==!0){if(r=this.stg.get("pl"),!i.isDefined(r))for(t=0;t<c.length;t++)s=new RegExp(c[t].path,"gi"),s.exec(f)&&(r=100*Math.random()<c[t].sp?1:0,this.stg.set("pl",r));if(n=a.replay_repools,0===r&&n&&n.length>0)for(t=0;t<n.length;t++)o=new RegExp(n[t].path,"gi"),o.exec(f)&&(r=100*Math.random()<n[t].sp?1:0,this.stg.set("pl",r));e(!!r)}else e(!0)},w.prototype.optoutCheck=function(e,t){this.stg.fstg.sync(i.proxy(function(r){r&&"true"==r.optout&&parseInt(r.expires,10)>i.now()?t():e()},this),this.cfg.config.site_id+"_oo")},w.prototype.browserCheck=function(e,t){return!(!e.isMobile&&t.config.browser_cutoff[e.browser.name]&&e.browser.actualVersion<t.config.browser_cutoff[e.browser.name])},w.prototype.platformCheck=function(e,t){return!(t.config.platform_cutoff[e.os.name]&&e.os.version<t.config.platform_cutoff[e.os.name])},w.prototype.checkDeviceBlacklist=function(e,t){for(var i=0;i<t.config.device_blacklist.length;i++)if(e.agent.toLowerCase().indexOf(t.config.device_blacklist[i].toLowerCase())>-1)return!1;return!0},w.prototype._match=function(e,t,i){var r=e.include,s=e[i||"globalExclude"];if(e.criteria){if(!e.criteria.supportsSmartPhones&&!t.isTablet&&t.isMobile)return!1;if(!e.criteria.supportsTablets&&t.isTablet)return!1;if(!e.criteria.supportsDesktop&&!t.isMobile)return!1}var n=window.location.href.toString(),o=document.referrer.toString();({urls:n,referrers:o,userAgents:window.navigator.userAgent});if(s){var a=this.runAllTests(s,t,!1,!0);if(a)return!1}return!r||this.runAllTests(r,t,!1,!0)},w.prototype.runAllTests=function(e,t,r,s){function n(e,t){i.isArray(t)||(t=[t]);for(var r=0,s=t.length;r<s;r++)if("string"==typeof t[r]&&(t[r]=t[r].replace(/-_DS_-/gi,"$")),(e+"").match(t[r]))return!0;return!1}var o,a=new i.Cookie({}),c=window.location.href.toString(),f=document.referrer.toString(),l={urls:c,referrers:f,userAgents:window.navigator.userAgent};for(var u in e){var d=e[u];if(d.length>0){if(o=!1,l[u])o=n(l[u],d);else if("browsers"==u)for(var h=t.browser.name,p=t.browser.actualVersion,g=0;g<d.length;g++)h.toLowerCase().indexOf(d[g].name.toLowerCase())>-1&&(d[g].comparison?"lt"==d[g].comparison&&p<d[g].version?o=!0:"eq"==d[g].comparison&&p==d[g].version?o=!0:"gt"==d[g].comparison&&p>d[g].version&&(o=!0):o=!0);else if("cookies"==u)for(var v=0;v<d.length;v++){var w=d[v],m=a.get(w.name);i.isDefined(w.value)&&m==w.value?o=!0:!i.isDefined(w.value)&&m&&(o=!0)}else if("variables"==u)for(var y=0;y<d.length;y++){var b=d[y],_=new[].constructor.constructor("return "+b.name),E=_.call(window);i.isDefined(b.value)&&E==b.value?o=!0:!i.isDefined(b.value)&&E&&(o=!0)}if(!o&&r)return!0;if(o&&s)return!0}}return!1};var m=function(e){this.cfg=e};m.prototype._bindToLink=function(e,t){for(var r=document.querySelectorAll(e.selector),s=function(e,t,r){return function(s){t.preventDefault&&i.preventDefault(s),r.call(e,t)}},n=0;n<r.length;n++){var o,a=r[n],c=!0;if(e.attribute&&(o=a.getAttribute(e.attribute),c=!1,o&&(c=!0,e.patterns&&e.patterns.length>0))){c=!1;for(var f=0;f<e.patterns.length;f++)if(o.toLowerCase().indexOf(e.patterns[f].toLowerCase())>-1){c=!0;break}}c&&i.Bind(a,"trigger:click",s(this,e,t))}},m.prototype.performBindings=function(e){if(e&&this.cfg){var t,i=this.cfg;if(i.cancel&&i.cancel.length>0){var r=function(){e.cancelTracker()};for(t=0;t<i.cancel.length;t++)this._bindToLink(i.cancel[t],r)}if(i.survey&&i.survey.length>0){var s=function(){e.popSurvey()};for(t=0;t<i.survey.length;t++)this._bindToLink(i.survey[t],s)}if(i.tracker&&i.tracker.length>0){var n=function(){e.popTracker()};for(t=0;t<i.tracker.length;t++)this._bindToLink(i.tracker[t],n)}}};var y=function(e,s,n,o,a,c){var f={},l=e.FSR||{};l.CPPS;f.CPPS=o,f.clearState=function(){s.reset(),a.kill("acs.ovr")},f.config=function(){return config},f.optOut=function(){var e=window.location.toString();window.location=e.indexOf("#")?e.substr(0,e.indexOf("#")-1)+"#acscommand=fsoptout":e+"#acscommand=fsoptout",window.location.reload()},f.test=function(){var e=window.location.toString();window.location=e.indexOf("#")?e.substr(0,e.indexOf("#")-1)+"#acscommand=fstest":e+"#acscommand=fstest",window.location.reload()};var u;f.run=f.pageReset=function(){u&&(clearTimeout(u),u=null),u=setTimeout(function(){var e=r.trig;e&&(e.dispose(),r.trig=null),t.startTS=i.now(),setTimeout(function(){T()},50)},250)},f.showInvite=function(e){var t=new i.Browser;t.browserReady.subscribe(i.proxy(function(){var i=r.trig||_(s,config,t,n,o,a,c);if(i.init()&&i.surveydef){new d(i,t,s,o,c,e,function(){this.initialize()})}},this),!0,!0)},f.getCookie=function(e){return a.get(e)};var h=config.config.publicApiName||"FSR";e[h]||(e[h]={}),i.ext(e[h],f,!1)},b=function(s,n,o,a,c,f){n&&i.isDefined(window.Uint8Array)&&a&&e([t.makeURI("foresee/fs.record.js")],function(e){c.set("cxreplayaws","true"),o.set("rc","true"),r.rec=e.getInstance(s,window,o),f&&(f.recordController=rec)})},_=function(e,config,t,r,s,n,a){var c=new E(e,config,t,r,s);return c.heartbeatExpired.subscribe(i.proxy(function(){var t=n.get("acs.ta");t||(n.kill("acs.ta"),u.log(u.SERVICE_TYPES.event,window.location.toString(),config,c.surveydef,e,o.TRACKER_CLOSED))},this),!0,!1),c},E=function(e,r,s,n,o){this.stg=e,this.cfg=r,this.browser=s,this.crit=n,this.cpps=o,e.get("pv")||(o.set("terms",this.decodeReferrer()||""),o.set("browser",s.browser.name+" "+s.browser.version),o.set("os",s.os.name),o.set("flash",i.Flash.getVersion()),o.set("hosted",t.makeURI("/").indexOf("answerscloud.com")>-1),o.set("referrer",document.referrer.toString()),o.set("site",r.config.site_id),o.set("trigger_version",r.config.version)),this.trkhb=new h(e.fstg),this.heartbeatExpired=new i.FSEvent;var a=!1;e.fstg.trackerMsg.subscribe(i.proxy(function(e){e&&e.acsSurveyDisplayed&&(a=!0)},this)),this.trkhb.heartbeatExpired.subscribe(i.proxy(function(){a||this.heartbeatExpired.fire()},this),!0,!1)};E.prototype.doesPassCriteria=function(){var e=this.crit;return!!(e.platformCheck(this.browser,this.cfg)&&e.browserCheck(this.browser,this.cfg)&&e.checkDeviceBlacklist(this.browser,this.cfg))},E.prototype.popTracker=function(e){var t=this;if(this.stg.set("i","x"),this.didPopTrackerAlready="y"==this.stg.get("dt"),!this.didPopTrackerAlready){this.stg.set("dt","y");var i=function(){t.tracker=new p(e.template,t.surveydef,config,t.stg,t.stg.fstg,config.config.events,t.cpps,e.display,t.browser),t.tracker.show(t.browser)};if(e)i();else{var r=s("about:blank","acsTracker",{width:700,height:400},this.browser,!0);new d(this,t.browser,t.stg,t.cpps,config.config.events,(!1),function(){t.tracker=new p(this.invite.template,t.surveydef,config,t.stg,t.stg.fstg,config.config.events,t.cpps,this.invite.display,t.browser),t.tracker.applyExisting(t.browser,r)})}}},E.prototype.canDisplayInvitation=function(){return this.crit._match(this.cfg.config,this.browser,"inviteExclude")},E.prototype.popSurvey=function(){if(this.stg.set("i","x"),this.didPopTrackerAlready="y"==this.stg.get("dt"),this.didPopTrackerAlready)this.stg&&this.stg.fstg&&this.stg.fstg._postMessage("trackercmd",{method:"survey"});else{this.stg.set("dt","y");var e=new g(config,this.cpps,this.surveydef),t=e.getUrl();s(t,"acsSurvey",{width:700,height:400},this.browser,!0);u.log(u.SERVICE_TYPES.event,window.location.toString(),config,this.surveydef,this.stg,o.SURVEY_SHOWN)}},E.prototype.init=function(){var e,t,r,s=this.cfg.surveydefs,n=this.stg.get("def");for(e=0;e<s.length;e++)r=s[e],t&&(r=i.ext(t,r),!s[e].site&&t.site&&delete r.site,!s[e].section&&t.section&&delete r.section,s[e]=r),t=i.ext({},r);if(i.isDefined(n)&&parseInt(n)>s.length-1&&(n=void 0),i.isDefined(n)&&"default"!=s[parseInt(n)].selectMode&&"pin"!=s[parseInt(n)].selectMode){if(i.isDefined(n)||"lock"==s[parseInt(n)].selectMode)return r=s[parseInt(n)],this.cfg.active_surveydef=r,this.surveydef=r,this._setupTrueConversionIfRequired(),this.locale=this._initLocale(),this.cpps.set("locale",this.locale),r}else for(e=0;e<(i.isDefined(n)&&"default"!=s[parseInt(n)].selectMode?parseInt(n)+1:s.length);e++)if(r=s[e],i.isDefined(n)&&n==e&&"default"!=s[parseInt(n)].selectMode||this.crit._match(r,this.browser))return this.cfg.active_surveydef=r,this.surveydef=r,this._setupTrueConversionIfRequired(),this.locale=this._initLocale(),this.cpps.set("locale",this.locale),this.stg.set("def",e),r;return!1},E.prototype._initLocale=function(){var e,t=this.surveydef,r=t.language;if(i.isDefined(r.src)&&i.isDefined(r.locales)){switch(r.src){case"variable":i.isDefined(r.name)&&(e=window[r.name]);break;case"cookie":if(i.isDefined(r.name)){var s=new i.Cookie({});e=s.get(r.name)}break;case"url":var n=r.locales;if(i.isDefined(n))for(var o=0,a=n.length;o<a;o++)if(i.isDefined(n[o].locale)&&i.isDefined(n[o].match)&&location.href.match(n[o].match))return n[o].locale;if(i.isDefined(r.locale))return r.locale}if(e)for(var c=0;c<r.locales.length;c++)if(r.locales[c].match==e)return r.locale=r.locales[c].locale,r.locale}return"en"},E.prototype.cancelTracker=function(){this.stg&&this.stg.fstg&&this.stg.fstg._postMessage("trackercmd",{method:"close"})},E.prototype._setupTrueConversionIfRequired=function(){var r=(this.surveydef,this.cfg.config);r.trueconversion&&r.trueconversion.enabled&&e([t.makeURI("foresee/fs.trueconversion.js")],i.proxy(function(e){this.trueconversion=new e(this,u)},this))},E.prototype.logState=function(){this.pageViewCount=(this.stg.get("pv")||0)+1,this.stg.set("pv",this.pageViewCount)},E.prototype.logDefState=function(){this.surveydef&&(this.defPageViewCount=(this.stg.get(this.surveydef.name+"pv")||0)+1,this.stg.set(this.surveydef.name+"pv",this.defPageViewCount))},E.prototype.evalLoyaltySampling=function(){var e=this.surveydef,t=this.stg.get("pl"),r=i.isDefined(t)&&1!=t?e.criteria.sp.outreplaypool||0:e.criteria.sp.reg||0,s=100*Math.random();return this.defPageViewCount>=e.criteria.lf&&s<=r},E.prototype.decodeReferrer=function(){var e,t,i=document.referrer||"",r=null,s=["q","p","query"];for(t=0;t<s.length&&!(r=i.match(new RegExp("[?&]"+s[t]+"=([^&]*)")));t++);return r?(e=decodeURIComponent(r[1]),e&&(e=e.replace(/\+/g," ")),e):e},E.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.trueconversion&&this.trueconversion.dispose(),this.invite&&this.invite.dispose(),r.rec&&(r.rec.dispose(),r.rec=null),i.Unbind("trigger:*"))};var S=function(e,t,r,s,n){this.itype=e,this.cfg=t,this.def=r,this.cpps=s,this.rid=n,this._measureName=this.def.name+"-"+(i.isDefined(this.def.site)?this.def.site+"-":"")+(i.isDefined(this.def.section)?this.def.section+"-":"")+this.def.language.locale};S.prototype.init=function(e,t){t=t||function(){};var r=i.now()+"_"+Math.round(1e13*Math.random());u.ping(u.SERVICE_TYPES.mobileOnExitInitialize,{a:r,notify:e,b:i.hash(r),c:864e5,cid:this.cfg.config.id,sid:this._measureName,rid:this.rid,uid:i.now(),support:"SMSEMAIL"==this.itype?"b":"EMAIL"==this.itype?"e":"s",cpps:"version="+encodeURIComponent(this.cfg.config.version)+"&"+this.cpps.toQueryString()},t,t)},S.prototype.beginHeartbeat=function(){this._timer&&(clearTimeout(this._timer),this._timer=null);var e=i.proxy(function(){u.ping(u.SERVICE_TYPES.mobileOnExitHeartbeat,{cid:this.cfg.config.id,sid:this._measureName,rid:this.rid,uid:i.now()},function(){},function(){})},this);this._timer=setInterval(e,config.config.onExitMobileHeartbeatInterval),e()};var k=config.config.events,I=window!=window.top;if(k.loaded&&k.loaded(),("dontRunOtherIframes"!==config.config.workInIframes&&config.config.workInIframes||!I)&&!(window.__fsrtracker||window.location.toString().indexOf("survey.foreseeresults.com")>-1)){var T=function(){var e,s,n=i.getGlobalStore(config),o=new w(n,config),a=new i.CPPS(n),c=n.get("i"),f=new i.Cookie({path:"/",secure:!1,encode:!0});i.honorNavigationEvents=!config.config.ignoreNavigationEvents,y(window,n,o,a,f,k),setTimeout(i.proxy(function(){if(a.set("url",window.location.toString()),config.config.cpps){var t=config.config.cpps;for(var l in t){var u,h=t[l];if(i.isObject(h))switch(h.source){case"param":var g=i.getParam(h.val)||h.init||null;i.isDefined(g)&&null!==g?a.set(l,g):a.get(l)||a.set(l,"");break;case"variable":i.isDefined(window[h.val])?a.set(l,window[h.val]):a.get(l)||a.set(l,h.init||"");break;case"cookie":var v=f.get(h.val);i.isDefined(v)&&null!==v?a.set(l,v):a.get(l)||a.set(l,h.init||"");break;case"url":for(var w=0,y=h.patterns.length;w<y;w++)u=h.patterns[w].value,i.isString(location.href)&&location.href.match(h.patterns[w].regex)?a.set(l,u):a.get(l)||a.set(l,h.init||"");break;case"function":i.isFunction(h.value)&&(u=h.value.call(window),a.set(l,u))}else a.set(l,h)}}var E=n.ckie.get("acs.ovr");if(E){E=JSON.parse(E);for(var S=0;S<config.surveydefs.length;S++){var T=config.surveydefs[S].name;E.sp[T]&&(config.surveydefs[S].criteria.sp=E.sp[T]),E.lf[T]&&(config.surveydefs[S].criteria.lf=E.lf[T])}E.pooloverride===!0&&(o.pooloverride=!0)}if("a"==c){var D=parseInt(n.get("rw"));D<i.now()&&(n.erase("i"),n.erase("rw"),c=null)}var C=new i.Browser;C.browserReady.subscribe(function(){if("runRecordOnly"===config.config.workInIframes&&I){for(var t=!1,l=0;l<config.surveydefs.length;l++){var u=config.surveydefs[l].cxRecord;if(u){t=!0;break}}return void b(C,t,n,!0,a)}if("d"!=c&&"a"!=c)o.calcReplayPoolStatus(function(t){return!!t&&void o.optoutCheck(i.proxy(function(){if(o._match(config.config,C,"globalExclude")&&"y"!=n.get("gx")){var i=r.trig=_(n,config,C,o,a,f,k);if(i.logState(),a.set("pv",i.pageViewCount),i.init()&&(k.initialized&&k.initialized(a),i.doesPassCriteria()&&i.surveydef)){if(i.logDefState(),b(C,i.surveydef.cxRecord,n,t,a),"x"!=c){if(i.evalLoyaltySampling()&&i.canDisplayInvitation()){new d(i,C,n,a,k,(!1),function(){this.initialize()})}}else e=new p(null,i.surveydef,config,n,n.fstg,k,a,null,C);i.surveydef.links&&(s=new m(i.surveydef.links),s.performBindings(i))}}else n.setSession("gx","y")},this),function(){})});else if("a"==c){var h="true"==n.get("rc")||n.get("rc")===!0;b(C,h,n,h,a)}},!0,!0)},this),Math.max(0,config.config.triggerDelay-(i.now()-t.startTS)))};t.domReady(T),i.pageNavEvent.subscribe(function(){var e=window,t=e[config.config.publicApiName||"FSR"];t&&acsReady(function(){t.pageReset()})},!1,!1)}});